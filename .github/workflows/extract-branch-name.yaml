name: Extract Branch names

on:
  push:
    branches:
      - main
      - qa
      - dev
      - 'release/*'
      - 'feature/*'

jobs:
  extract:
    runs-on: ubuntu-latest

    steps:
      - name: Extract names
        run: |
          echo 'github.ref: ' ${{ github.ref }}

      - name: Extract version from branch name
        id: extract_version
        run: |
          # Извлекаем имя ветки из переменной GITHUB_REF
          branch_name="${GITHUB_REF#refs/heads/}"
          
          # Используем регулярное выражение для извлечения версии
          if [[ "$branch_name" =~ release/([0-9]+\.[0-9]+\.[0-9]+) ]]; then
          version="${BASH_REMATCH[1]}"
          echo "Version: $version"
          echo "RELEASE_VERSION=${version} >> ${GITHUB_STATE}
          echo "::set-output name=version::$version"
          else
          echo "Не удалось извлечь версию из имени ветки"
          exit 1
          fi

      - name: Save state
        run: echo "{name}={value}" >> $GITHUB_STATE

      - name: Use extracted version
        run: echo "Extracted version is ${{ steps.RELEASE_VERSION }}"